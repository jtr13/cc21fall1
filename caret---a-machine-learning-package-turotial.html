<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 21 caret - a machine learning package turotial | EDAV Fall 2021 Mon/Wed Community Contributions</title>
<meta name="author" content="the students of the class">
<meta name="description" content="Jiang Zhu and Xuechun Bai Motivation: The motivation for this community contribution project is to introduce to classmates a package in R that can easily implement machine learning algorithms in...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 21 caret - a machine learning package turotial | EDAV Fall 2021 Mon/Wed Community Contributions">
<meta property="og:type" content="book">
<meta property="og:description" content="Jiang Zhu and Xuechun Bai Motivation: The motivation for this community contribution project is to introduce to classmates a package in R that can easily implement machine learning algorithms in...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 21 caret - a machine learning package turotial | EDAV Fall 2021 Mon/Wed Community Contributions">
<meta name="twitter:description" content="Jiang Zhu and Xuechun Bai Motivation: The motivation for this community contribution project is to introduce to classmates a package in R that can easily implement machine learning algorithms in...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet">
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script><script src="libs/dygraphs-1.1.1/shapes.js"></script><script src="libs/moment-2.8.4/moment.js"></script><script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script><script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script><script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/forceNetwork-binding-0.4/forceNetwork.js"></script><script src="libs/detect-resize-0.5.3/jquery.resize.js"></script><link href="libs/jquery-ui-1.11.4/jquery-ui.min.css" rel="stylesheet">
<script src="libs/jquery-ui-1.11.4/jquery-ui.min.js"></script><script src="libs/vega-1.4.3/vega.min.js"></script><script src="libs/lodash-2.2.1/lodash.min.js"></script><script>var lodash = _.noConflict();</script><link href="libs/ggvis-0.4.7/css/ggvis.css" rel="stylesheet">
<script src="libs/ggvis-0.4.7/js/ggvis.js"></script><script src="libs/dendroNetwork-binding-0.4/dendroNetwork.js"></script><link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet">
<script src="libs/str_view-binding-1.4.0/str_view.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">EDAV Fall 2021 Mon/Wed Community Contributions</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome!</a></li>
<li><a class="" href="community-contribution.html"><span class="header-section-number">2</span> Community Contribution</a></li>
<li><a class="" href="github-submission-instructions.html"><span class="header-section-number">3</span> GitHub submission instructions</a></li>
<li><a class="" href="sample-project.html"><span class="header-section-number">4</span> Sample project</a></li>
<li class="book-part">Data Visualizations</li>
<li><a class="" href="introduction-to-the-lattice-package.html"><span class="header-section-number">5</span> Introduction to the lattice package</a></li>
<li><a class="" href="graph-animation-with-gganimate-and-after-effects.html"><span class="header-section-number">6</span> Graph animation with gganimate and After Effects</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">7</span> Interactive Plots</a></li>
<li class="book-part">Cheatsheets</li>
<li><a class="" href="r-vs.-python-visualization-cheatsheet.html"><span class="header-section-number">8</span> R vs. Python Visualization Cheatsheet</a></li>
<li><a class="" href="rpackage-waffle-cheatsheet.html"><span class="header-section-number">9</span> Rpackage waffle cheatsheet</a></li>
<li><a class="" href="r-cheatsheet-on-data-transforamtion-and-exploration.html"><span class="header-section-number">10</span> R cheatsheet on data transforamtion and exploration</a></li>
<li><a class="" href="r-vs-python-basic-data-wrangling.html"><span class="header-section-number">11</span> R vs Python Basic Data Wrangling</a></li>
<li><a class="" href="tidyverse_cheatsheet.html"><span class="header-section-number">12</span> tidyverse_cheatsheet</a></li>
<li><a class="" href="cheatsheet-tidyverse.html"><span class="header-section-number">13</span> Cheatsheet Tidyverse</a></li>
<li><a class="" href="use-of-ggprism-and-ggsci-packages.html"><span class="header-section-number">14</span> Use of ggprism and ggsci packages</a></li>
<li><a class="" href="interactive-plot-introduction.html"><span class="header-section-number">15</span> Interactive plot introduction</a></li>
<li class="book-part">Tutorials</li>
<li><a class="" href="multithreading-crawler-frame.html"><span class="header-section-number">16</span> Multithreading Crawler Frame</a></li>
<li><a class="" href="regression-and-classification-in-r.html"><span class="header-section-number">17</span> Regression and Classification in R</a></li>
<li><a class="" href="tibble-vs.-dataframe.html"><span class="header-section-number">18</span> Tibble vs. DataFrame</a></li>
<li><a class="" href="introduction-to-time-series.html"><span class="header-section-number">19</span> Introduction to Time Series</a></li>
<li><a class="" href="vipul-edav-community-contribution-kickstart-r.html"><span class="header-section-number">20</span> Vipul EDAV Community Contribution Kickstart R</a></li>
<li><a class="active" href="caret---a-machine-learning-package-turotial.html"><span class="header-section-number">21</span> caret - a machine learning package turotial</a></li>
<li><a class="" href="streamlit-for-financial-analysis.html"><span class="header-section-number">22</span> Streamlit for Financial Analysis</a></li>
<li><a class="" href="interactive-graphs-tutorial.html"><span class="header-section-number">23</span> Interactive graphs tutorial</a></li>
<li><a class="" href="guideline-on-using-package-rcurl-and-xml-for-web-scraping.html"><span class="header-section-number">24</span> Guideline on Using Package Rcurl and XML for Web Scraping</a></li>
<li><a class="" href="introduction-to-data-manipulation.html"><span class="header-section-number">25</span> Introduction to Data Manipulation</a></li>
<li><a class="" href="animating-the-plots-in-r.html"><span class="header-section-number">26</span> Animating the plots in R</a></li>
<li class="book-part">Workshops</li>
<li><a class="" href="data-science-product-cycles-in-enterprises.html"><span class="header-section-number">27</span> Data Science Product Cycles in Enterprises</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="github-initial-setup.html"><span class="header-section-number">28</span> Github initial setup</a></li>
<li><a class="" href="tutorial-for-pull-request-mergers.html"><span class="header-section-number">29</span> Tutorial for pull request mergers</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jtr13/cc21fall1">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="caret---a-machine-learning-package-turotial" class="section level1">
<h1>
<span class="header-section-number">21</span> caret - a machine learning package turotial<a class="anchor" aria-label="anchor" href="#caret---a-machine-learning-package-turotial"><i class="fas fa-link"></i></a>
</h1>
<p>Jiang Zhu and Xuechun Bai</p>
<p>Motivation: The motivation for this community contribution project is to introduce to classmates a package in R that can easily implement machine learning algorithms in few lines of code. As python users who commonly use the package <code>scikit-learn</code> to deploy machine laerning models, we strived to find a similar R package that has similar functions. While finding the resources online, we discovered that <code>caret</code> is a great package with neatly defined functions that create a easy-to use interface for machine learning algorithms, and at the same time, it has abundant machine learning models and preprocessing and model selection functions. However, we have not found any great tutorial or easy-to-read API’s for caret. Therefore, in this markdown file, we will illustrate how to use the <code>caret</code> package in a example-based manner. We eliminate the mathematics behind each model as much as possible to focus on the implementation of the algorithm in R. We will also demonstrate the results of our experiments of <code>caret</code> model on datasets with visualization tools.</p>
<div class="sourceCode" id="cb308"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">kernlab</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.milbo.users.sonic.net/earth/">earth</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jefferis/RANN">RANN</a></span><span class="op">)</span></code></pre></div>
<div id="introduction-and-description-of-dataset" class="section level2">
<h2>
<span class="header-section-number">21.1</span> Introduction and description of dataset<a class="anchor" aria-label="anchor" href="#introduction-and-description-of-dataset"><i class="fas fa-link"></i></a>
</h2>
<p>For the tutorial, we will use a data frame about Orange Juice which includes two orange juice brands, Citrus Hill (CH) and Minute Maid (MM) and selling information according to each brand. The URL of the dataset is : <a href="https://raw.githubusercontent.com/selva86/datasets/master/orange_juice_withmissing.csv" class="uri">https://raw.githubusercontent.com/selva86/datasets/master/orange_juice_withmissing.csv</a>, which contains 18 cloumns and 1070 rows.</p>
<p>The first column “Purchase” introduces brand of orange juice. the data contains weekly amount of purchase of the two brands (WeekofPurchase) with the store id (StoreID) where the orange juice was sold, and the price of the orange juice according to brand CH (PriceCH) and MM (PriceMM). The data also includes the discount (“DiscCH” and “DiscMM”), sale price(“SalePriceCH” and “SalePriceMM”) and other useful information about those two orange juice brands. The goal of our tutorial is to predict the customers’ preference between two brands when choosing to buy a orange juice, so we will only focusing on the “Purchase” for now.</p>
<p>Now let us firstly import the data, and state a briefly summary about this data:</p>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Import dataset</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/selva86/datasets/master/orange_juice_withmissing.csv'</span><span class="op">)</span>

<span class="co"># Structure of the dataframe</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></code></pre></div>
<pre><code>##   Purchase WeekofPurchase StoreID PriceCH PriceMM DiscCH DiscMM SpecialCH
## 1       CH            237       1    1.75    1.99   0.00    0.0         0
## 2       CH            239       1    1.75    1.99   0.00    0.3         0
## 3       CH            245       1    1.86    2.09   0.17    0.0         0
## 4       MM            227       1    1.69    1.69   0.00    0.0         0
## 5       CH            228       7    1.69    1.69   0.00    0.0         0
## 6       CH            230       7    1.69    1.99   0.00    0.0         0
##   SpecialMM  LoyalCH SalePriceMM SalePriceCH PriceDiff Store7 PctDiscMM
## 1         0 0.500000        1.99        1.75      0.24     No  0.000000
## 2         1 0.600000        1.69        1.75     -0.06     No  0.150754
## 3         0 0.680000        2.09        1.69      0.40     No  0.000000
## 4         0 0.400000        1.69        1.69      0.00     No  0.000000
## 5         0 0.956535        1.69        1.69      0.00    Yes  0.000000
## 6         1 0.965228        1.99        1.69      0.30    Yes  0.000000
##   PctDiscCH ListPriceDiff STORE
## 1  0.000000          0.24     1
## 2  0.000000          0.24     1
## 3  0.091398          0.23     1
## 4  0.000000          0.00     1
## 5  0.000000          0.00     0
## 6  0.000000          0.30     0</code></pre>
</div>
<div id="pre-processing" class="section level2">
<h2>
<span class="header-section-number">21.2</span> Pre-processing<a class="anchor" aria-label="anchor" href="#pre-processing"><i class="fas fa-link"></i></a>
</h2>
<p>After importing the dataset, we need to separate data into training and testing sets. The training set is used as examples for machine learning models to learn generalize, and the test set is used to evaluate the preformance of our models. We can achieve this by using <code><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition()</a></code> in caret package.</p>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span>
  <span class="va">y</span>,
  <span class="va">times</span>,
  <span class="va">p</span>,
  <span class="va">list</span>
<span class="op">)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p><code>y</code> specifies the column to which we will partition the data</p></li>
<li><p><code>times</code> specifies how many times we will partition nthe data</p></li>
<li><p><code>p</code> specifies the proportion to which we split the data</p></li>
<li><p><code>list</code> is a boolean indicating whether we return a list</p></li>
</ol>
<p>Here we set 70% of training set and 30% of testing set.</p>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#set random seed to produce the same result</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="co">#use createDataPartition() function to get row of training. The input variable here is "Purchase" in df, and p = .7 implies the percentage of dataset we want to take. Here we set the training with 70%, so we let p equals to 0.7. Using List = F we are able to prevent the result as being a list instead of a dataframe.</span>
<span class="va">rowOfTrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Purchase</span>, p<span class="op">=</span><span class="fl">0.7</span>, list<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># create datasets for training and testing</span>
<span class="va">train_df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">rowOfTrain</span>,<span class="op">]</span>
<span class="va">test_df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="op">-</span><span class="va">rowOfTrain</span>,<span class="op">]</span></code></pre></div>
<p>The next step is to clear or refill the missing values or NAs in the dataset. There are several ways of trasnformation such as fill the missing value into mean, mode or simply delete the row of missing values. Using caret package, we can apply the NAs to more practical values, which is to predict the missing values by other values that are listed in the dataset. The way <code>caret</code> package can do is to use <code><a href="https://rdrr.io/pkg/caret/man/preProcess.html">preProcess()</a></code> function to make k-Nearest Neighbors and use it with training set.</p>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/caret/man/preProcess.html">preProcess</a></span><span class="op">(</span>
  <span class="va">data</span>,
  <span class="va">method</span>
<span class="op">)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p><code>data</code> specifies the dataframe we want to apply the preprocessing</p></li>
<li><p><code>method</code> is a string that specifies the method for preprocessing</p></li>
</ol>
<p>Then we will get a Nearest model for perdicting the missing values. After that, we will use <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> to fill the missing values with our prediction.</p>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create k-Nearest with training data using method = 'knnImpute'</span>
<span class="va">knn_inputer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/preProcess.html">preProcess</a></span><span class="op">(</span><span class="va">train_df</span>, method<span class="op">=</span><span class="st">'knnImpute'</span><span class="op">)</span>
<span class="va">knn_inputer</span></code></pre></div>
<pre><code>## Created from 727 samples and 18 variables
## 
## Pre-processing:
##   - centered (16)
##   - ignored (2)
##   - 5 nearest neighbor imputation (16)
##   - scaled (16)</code></pre>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Import the prediction into missing values using function predict()</span>
<span class="va">train_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">knn_inputer</span>, newdata <span class="op">=</span> <span class="va">train_df</span><span class="op">)</span>

<span class="co">#Check the NAs in the training dataset</span>
<span class="fu"><a href="https://rdrr.io/r/base/NA.html">anyNA</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>From the result, we can see the prediction model has centered with 16 variables, ignored with 2 and was created from 825 samples and 18 variables. Then after importing the NAs by “predict” function, we then check if there are any missing values remaining in the dataset using angNA() function. The result of “FALSE” shows that the missing values are all replaced.</p>
<p>Another work the caret package can do is to transform the categorical variables into one-hot vectors to have a numerical representation of categorical variables. An one-hot vector is constructed as follows: suppose there are <span class="math inline">\(n\)</span> classes of categorical variables. Then we represent each class <span class="math inline">\(i\)</span> by a <span class="math inline">\(n\)</span>-dimensional vector <span class="math inline">\(o_i\)</span> such that <span class="math inline">\(o_i[i]=1\)</span> and <span class="math inline">\(o_i[j]=0\)</span> for all <span class="math inline">\(j\neq i\)</span></p>
<p>We can acheive the one-hot transformation using the <code><a href="https://rdrr.io/pkg/caret/man/dummyVars.html">dummyVars()</a></code></p>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/caret/man/dummyVars.html">dummyVars</a></span><span class="op">(</span>
  <span class="va">formula</span>,
  <span class="va">data</span>
<span class="op">)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p><code>formula</code> repersents a way to inpute the data</p></li>
<li><p><code>data</code> represents the dataframe</p></li>
</ol>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define the one-hot encoding object</span>
<span class="va">one_hot_encoder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/dummyVars.html">dummyVars</a></span><span class="op">(</span><span class="va">Purchase</span><span class="op">~</span><span class="va">.</span>, <span class="va">train_df</span><span class="op">)</span>

<span class="co"># results after applying one-hot encoding</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">one_hot_encoder</span>, <span class="va">train_df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##   WeekofPurchase   StoreID     PriceCH     PriceMM     DiscCH     DiscMM
## 1     -1.1406992 -1.267157 -1.16230500 -0.70167093 -0.4532457 -0.5650681
## 2     -1.0116414 -1.267157 -1.16230500 -0.70167093 -0.4532457  0.8702789
## 3     -0.6244679 -1.267157 -0.08909746  0.03485153  0.9895487 -0.5650681
## 4     -1.7859884 -1.267157 -1.74769093 -2.91123832 -0.4532457 -0.5650681
## 5     -1.7214595  1.327114 -1.74769093 -2.91123832 -0.4532457 -0.5650681
## 6     -1.5924017  1.327114 -1.74769093 -0.70167093 -0.4532457 -0.5650681
##    SpecialCH  SpecialMM     LoyalCH SalePriceMM SalePriceCH  PriceDiff Store7No
## 1 -0.4101973 -0.4461947 -0.24490422  0.08791265  -0.4606397  0.3276049        1
## 2 -0.4101973  2.2381700  0.08369962 -1.10522569  -0.4606397 -0.7838676        1
## 3 -0.4101973 -0.4461947  0.34658269  0.48562543  -0.8807610  0.9203903        1
## 4 -0.4101973 -0.4461947 -0.57350806 -1.10522569  -0.8807610 -0.5615731        1
## 5 -0.4101973 -0.4461947  1.25528731 -1.10522569  -0.8807610 -0.5615731        0
## 6 -0.4101973  2.2381700  1.28385285  0.08791265  -0.8807610  0.5498994        0
##   Store7Yes  PctDiscMM PctDiscCH ListPriceDiff      STORE
## 1         0 -0.5718037 -0.449862     0.2132873 -0.4419062
## 2         0  0.9396462 -0.449862     0.2132873 -0.4419062
## 3         0 -0.5718037  1.016257     0.1218262 -0.4419062
## 4         0 -0.5718037 -0.449862    -1.9817791 -0.4419062
## 5         1 -0.5718037 -0.449862    -1.9817791 -1.1401926
## 6         1 -0.5718037 -0.449862     0.7620539 -1.1401926</code></pre>
<p>As we can see, the <code>Store7.No</code> and <code>Store7.Yes</code> represent the one-hot encoding. We will not actually apply it to the dataset because <code>caret</code> supports factor as the labels.</p>
</div>
<div id="model-training" class="section level2">
<h2>
<span class="header-section-number">21.3</span> Model training<a class="anchor" aria-label="anchor" href="#model-training"><i class="fas fa-link"></i></a>
</h2>
<p>The machine learning models are defined and trained in <code>caret</code> by the <code><a href="https://rdrr.io/pkg/caret/man/train.html">train()</a></code> function. It is the core function that masks all the tedious detail of the machine learning algorithms and provide a convenient and concise interface. The <code><a href="https://rdrr.io/pkg/caret/man/train.html">train()</a></code> function has versions with different parameters:</p>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># first version of train</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span>
  <span class="va">formula</span>,
  <span class="va">data</span>,
  <span class="va">method</span>,
<span class="op">)</span>

<span class="co"># second version of train</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span>
  <span class="va">x</span>,
  <span class="va">y</span>,
  <span class="va">method</span>,
<span class="op">)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p><code>formula</code> specifies the way we want to construct our model</p></li>
<li><p><code>data</code> specifies the training data we want to use to construct the label</p></li>
<li><p><code>method</code> is a string specifiying the model we want to apply to the data</p></li>
</ol>
<p>The first version of the train function is recommended when we have all the data in a single dataframe. In another word, each column represents a feature <span class="math inline">\(x_i\)</span> with one column represents <span class="math inline">\(y\)</span>. The second version of the train function is recommended when we have <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> as separate dataframes. In the following code, we will use the first version of <code><a href="https://rdrr.io/pkg/caret/man/train.html">train()</a></code> on our prediction.</p>
<p>The method parameter can be specified conveniently by a string. By far there are 238 models supported by <code>caret</code> which can be found on <a href="https://topepo.github.io/caret/available-models.html" class="uri">https://topepo.github.io/caret/available-models.html</a>. In this tutorial, we will illustrate and apply several common classification algorithms on our dataset.</p>
<p>One amazing feature of <code>caret</code> is that for almost all methods, it will automatically finds the best hyperparameters for the user.</p>
<div id="k-nearest-neighbors" class="section level3">
<h3>
<span class="header-section-number">21.3.1</span> K-nearest neighbors<a class="anchor" aria-label="anchor" href="#k-nearest-neighbors"><i class="fas fa-link"></i></a>
</h3>
<p>k-nearest neighbor is the most intuitive classification algorithm. Given some positive <span class="math inline">\(k\)</span> and some data <span class="math inline">\(x\)</span>, k-neigherest neighbor finds the k nearest neighbors in the training set based on the euclidian distance
<span class="math display">\[dist(x,x')=\sqrt{(x_1-x'_1)^2+(x_2-x'_2)^2+\cdots + (x_n-x'_n)^2}\]</span>
and classifies <span class="math inline">\(x\)</span> as the class that contains the most nearst neighbors.</p>
<p>To implement such algorithm, we will specify the parameter <code>method=knn</code></p>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># training the knn model</span>
<span class="va">knn_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span>
  <span class="va">Purchase</span> <span class="op">~</span><span class="va">.</span>,
  <span class="va">train_df</span>,
  method <span class="op">=</span> <span class="st">"knn"</span>
<span class="op">)</span>

<span class="va">knn_model</span></code></pre></div>
<pre><code>## k-Nearest Neighbors 
## 
## 750 samples
##  17 predictor
##   2 classes: 'CH', 'MM' 
## 
## No pre-processing
## Resampling: Bootstrapped (25 reps) 
## Summary of sample sizes: 750, 750, 750, 750, 750, 750, ... 
## Resampling results across tuning parameters:
## 
##   k  Accuracy   Kappa    
##   5  0.7430519  0.4561180
##   7  0.7506511  0.4701385
##   9  0.7522812  0.4717872
## 
## Accuracy was used to select the optimal model using the largest value.
## The final value used for the model was k = 9.</code></pre>
</div>
<div id="logistics-regression" class="section level3">
<h3>
<span class="header-section-number">21.3.2</span> Logistics Regression<a class="anchor" aria-label="anchor" href="#logistics-regression"><i class="fas fa-link"></i></a>
</h3>
<p>logistics regression is linear model for binary classification, in another word, given features <span class="math inline">\(x_1,x_2,\cdots,x_n\)</span>, we want to predict <span class="math inline">\(y=\{0,1\}\)</span>. The model can be described by equation
<span class="math display">\[\hat{y}=\sigma(w_1\cdot x_1+w_2\cdot x_2+\cdots+w_n\cdot x_n)\]</span>
where the <span class="math inline">\(\sigma\)</span> function is defined by
<span class="math display">\[\sigma(x)=\frac{1}{1+e^{-x}}\]</span></p>
<p>we hope that the logistics regression algorithm can find the optimal <span class="math inline">\(w_1,\cdots,w_n\)</span> such that <span class="math inline">\(\hat{y}\)</span> is as closed to the true label <span class="math inline">\(y\)</span> as possible.</p>
<p>To implement such algorithm, we will specify the parameter <code>method="glm"</code>:</p>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># training the logistics regression model</span>
<span class="va">lr_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span>
  <span class="va">Purchase</span> <span class="op">~</span><span class="va">.</span>,
  <span class="va">train_df</span>,
  method <span class="op">=</span> <span class="st">"glm"</span>
<span class="op">)</span>

<span class="va">lr_model</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 750 samples
##  17 predictor
##   2 classes: 'CH', 'MM' 
## 
## No pre-processing
## Resampling: Bootstrapped (25 reps) 
## Summary of sample sizes: 750, 750, 750, 750, 750, 750, ... 
## Resampling results:
## 
##   Accuracy   Kappa    
##   0.8219706  0.6207552</code></pre>
</div>
<div id="support-vector-machine" class="section level3">
<h3>
<span class="header-section-number">21.3.3</span> Support vector machine<a class="anchor" aria-label="anchor" href="#support-vector-machine"><i class="fas fa-link"></i></a>
</h3>
<p>support vector machine is a hyperplane that separates the input space into two subspaces. In the case when only we have <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>, we want to draw a line that saparates the cartesian plane. The criteria for choosing such plane is the one that maximizes the distance to the closest data points from both classes. This gives rise to the optimization objective
<span class="math display">\[\max_{w,b}\frac{1}{\vert\vert w\vert\vert_2}\min_{x_i\in D}\vert w^Tx_i+b\vert,\quad \text{ s.t. }\forall i,\quad y_i(w^Tx_i+b)\ge 0 \]</span>
To implement such algorithm, we will specify the parameter <code>method="svmRadial"</code></p>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># training the support vector machine model, the library kernlab is needed to perform kernal transformation</span>
<span class="va">svm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span>
  <span class="va">Purchase</span> <span class="op">~</span><span class="va">.</span>,
  <span class="va">train_df</span>,
  method <span class="op">=</span> <span class="st">"svmRadial"</span>
<span class="op">)</span>

<span class="va">svm_model</span></code></pre></div>
<pre><code>## Support Vector Machines with Radial Basis Function Kernel 
## 
## 750 samples
##  17 predictor
##   2 classes: 'CH', 'MM' 
## 
## No pre-processing
## Resampling: Bootstrapped (25 reps) 
## Summary of sample sizes: 750, 750, 750, 750, 750, 750, ... 
## Resampling results across tuning parameters:
## 
##   C     Accuracy   Kappa    
##   0.25  0.8126657  0.5977679
##   0.50  0.8143211  0.6016239
##   1.00  0.8123949  0.5975775
## 
## Tuning parameter 'sigma' was held constant at a value of 0.05934766
## Accuracy was used to select the optimal model using the largest value.
## The final values used for the model were sigma = 0.05934766 and C = 0.5.</code></pre>
</div>
<div id="random-forest" class="section level3">
<h3>
<span class="header-section-number">21.3.4</span> Random Forest<a class="anchor" aria-label="anchor" href="#random-forest"><i class="fas fa-link"></i></a>
</h3>
<p>The decision tree algorithm learns to predict the value of a target variable by learning simple decision rules inferred from the data features. The process for constructing the tree is to first select a root node <span class="math inline">\(x_i\)</span> and a decision boundry <span class="math inline">\(b_i\)</span>. Then we recirsively select its children nodes and a corresponding decision threshold <span class="math inline">\(b\)</span> such that it maximizes the information gain. Since different initialization produces different results, random forest aims to create multiple trees with different initialization and collectively ageraging the result that is produced by each individual decision trees</p>
<p>To implement such algorithm, we will specify the parameter <code>method="earch"</code></p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># training the random forest model, the library earth is needed</span>
<span class="va">rf_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span>
  <span class="va">Purchase</span> <span class="op">~</span><span class="va">.</span>,
  <span class="va">train_df</span>,
  method <span class="op">=</span> <span class="st">"earth"</span>
<span class="op">)</span>

<span class="va">rf_model</span></code></pre></div>
<pre><code>## Multivariate Adaptive Regression Spline 
## 
## 750 samples
##  17 predictor
##   2 classes: 'CH', 'MM' 
## 
## No pre-processing
## Resampling: Bootstrapped (25 reps) 
## Summary of sample sizes: 750, 750, 750, 750, 750, 750, ... 
## Resampling results across tuning parameters:
## 
##   nprune  Accuracy   Kappa    
##    2      0.7958702  0.5634097
##   12      0.8095924  0.5959591
##   23      0.8081299  0.5933340
## 
## Tuning parameter 'degree' was held constant at a value of 1
## Accuracy was used to select the optimal model using the largest value.
## The final values used for the model were nprune = 12 and degree = 1.</code></pre>
</div>
</div>
<div id="model-prediction-and-evaluation" class="section level2">
<h2>
<span class="header-section-number">21.4</span> Model prediction and evaluation<a class="anchor" aria-label="anchor" href="#model-prediction-and-evaluation"><i class="fas fa-link"></i></a>
</h2>
<p>After we successfully train the models, it is time to evaluate them on the test set to validate if it is a good model. The key function to achieve this is the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function:</p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
  <span class="va">object</span>,
  <span class="va">newdata</span>
<span class="op">)</span></code></pre></div>
<p>To evaluate the models we have trained above, we can call the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function on each models:</p>
<div class="sourceCode" id="cb331"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># inpute the test data first</span>
<span class="va">test_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">knn_inputer</span>, <span class="va">test_df</span><span class="op">)</span></code></pre></div>
<p>we can compute the confution matrix for each model:</p>
<p>Confusion matrix for the knn model:</p>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">knn_cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>reference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">test_df</span><span class="op">$</span><span class="va">Purchase</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">knn_model</span>, <span class="va">test_df</span><span class="op">)</span>, mode<span class="op">=</span><span class="st">'everything'</span>, positive<span class="op">=</span><span class="st">'MM'</span><span class="op">)</span>

<span class="va">knn_cm</span><span class="op">$</span><span class="va">table</span></code></pre></div>
<pre><code>##           Reference
## Prediction  CH  MM
##         CH 169  30
##         MM  26  95</code></pre>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">knn_cm</span><span class="op">$</span><span class="va">table</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Reference</span>, y<span class="op">=</span><span class="va">Prediction</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">Freq</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"light blue"</span>, high<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">Freq</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Confution matrix for KNN model"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="caret_machine_learning_tutorial_files/figure-html/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Confusion matrix for the logistics regression model:</p>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lr_cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>reference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">test_df</span><span class="op">$</span><span class="va">Purchase</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lr_model</span>, <span class="va">test_df</span><span class="op">)</span>, mode<span class="op">=</span><span class="st">'everything'</span>, positive<span class="op">=</span><span class="st">'MM'</span><span class="op">)</span>

<span class="va">lr_cm</span><span class="op">$</span><span class="va">table</span></code></pre></div>
<pre><code>##           Reference
## Prediction  CH  MM
##         CH 164  20
##         MM  31 105</code></pre>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">lr_cm</span><span class="op">$</span><span class="va">table</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Reference</span>, y<span class="op">=</span><span class="va">Prediction</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">Freq</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"light blue"</span>, high<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">Freq</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Confution matrix for Logistics Regression model"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="caret_machine_learning_tutorial_files/figure-html/unnamed-chunk-20-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Confusion matrix for the svm model:</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svm_cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>reference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">test_df</span><span class="op">$</span><span class="va">Purchase</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">svm_model</span>, <span class="va">test_df</span><span class="op">)</span>, mode<span class="op">=</span><span class="st">'everything'</span>, positive<span class="op">=</span><span class="st">'MM'</span><span class="op">)</span>

<span class="va">svm_cm</span><span class="op">$</span><span class="va">table</span></code></pre></div>
<pre><code>##           Reference
## Prediction  CH  MM
##         CH 170  27
##         MM  25  98</code></pre>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">svm_cm</span><span class="op">$</span><span class="va">table</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Reference</span>, y<span class="op">=</span><span class="va">Prediction</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">Freq</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"light blue"</span>, high<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">Freq</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Confution matrix for SVM model"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="caret_machine_learning_tutorial_files/figure-html/unnamed-chunk-22-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Confusion matrix for the random forest model:</p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rf_cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>reference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">test_df</span><span class="op">$</span><span class="va">Purchase</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">svm_model</span>, <span class="va">test_df</span><span class="op">)</span>, mode<span class="op">=</span><span class="st">'everything'</span>, positive<span class="op">=</span><span class="st">'MM'</span><span class="op">)</span>

<span class="va">rf_cm</span><span class="op">$</span><span class="va">table</span></code></pre></div>
<pre><code>##           Reference
## Prediction  CH  MM
##         CH 170  27
##         MM  25  98</code></pre>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">rf_cm</span><span class="op">$</span><span class="va">table</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Reference</span>, y<span class="op">=</span><span class="va">Prediction</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">Freq</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"light blue"</span>, high<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">Freq</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Confution matrix for random forest model"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="caret_machine_learning_tutorial_files/figure-html/unnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;"></div>
<p>The <code>caret</code> package also provides a convenient function <code><a href="https://rdrr.io/pkg/caret/man/resamples.html">resamples()</a></code> to compare the metric between models.</p>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>KNN <span class="op">=</span> <span class="va">knn_model</span>, LR <span class="op">=</span> <span class="va">lr_model</span>, SVM <span class="op">=</span> <span class="va">svm_model</span>, RF <span class="op">=</span> <span class="va">rf_model</span><span class="op">)</span>

<span class="va">models_compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/resamples.html">resamples</a></span><span class="op">(</span><span class="va">model_list</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">models_compare</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## summary.resamples(object = models_compare)
## 
## Models: KNN, LR, SVM, RF 
## Number of resamples: 25 
## 
## Accuracy 
##          Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA's
## KNN 0.7025090 0.7343173 0.7491166 0.7522812 0.7703180 0.8197880    0
## LR  0.7909408 0.8118081 0.8201439 0.8219706 0.8297101 0.8763636    0
## SVM 0.7620818 0.8013937 0.8172043 0.8143211 0.8239700 0.8525180    0
## RF  0.7750000 0.7906137 0.8058608 0.8095924 0.8230769 0.8625954    0
## 
## Kappa 
##          Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA's
## KNN 0.3824306 0.4294194 0.4604863 0.4717872 0.5098018 0.6148838    0
## LR  0.5476278 0.5914299 0.6196513 0.6207552 0.6368782 0.7459377    0
## SVM 0.4965787 0.5830797 0.6013610 0.6016239 0.6178862 0.6848073    0
## RF  0.5198789 0.5579644 0.5906583 0.5959591 0.6214686 0.7077705    0</code></pre>
<p>As we can see that the random forest has the best performance on the dataset.</p>
</div>
<div id="reference-2" class="section level2">
<h2>
<span class="header-section-number">21.5</span> Reference<a class="anchor" aria-label="anchor" href="#reference-2"><i class="fas fa-link"></i></a>
</h2>
<p>Caret Package – A Practical Guide to Machine Learning in R - Selva Prabhakaran:
<a href="https://www.machinelearningplus.com/machine-learning/caret-package/#61howtotrainthemodelandinterprettheresults" class="uri">https://www.machinelearningplus.com/machine-learning/caret-package/#61howtotrainthemodelandinterprettheresults</a>?</p>
<p>A basic tutorial of caret: the machine learning package in R - Rebecca Barter:
<a href="https://www.rebeccabarter.com/blog/2017-11-17-caret_tutorial/" class="uri">https://www.rebeccabarter.com/blog/2017-11-17-caret_tutorial/</a></p>
<p>The caret Package - Max Kuhn:
<a href="https://topepo.github.io/caret/index.html" class="uri">https://topepo.github.io/caret/index.html</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="vipul-edav-community-contribution-kickstart-r.html"><span class="header-section-number">20</span> Vipul EDAV Community Contribution Kickstart R</a></div>
<div class="next"><a href="streamlit-for-financial-analysis.html"><span class="header-section-number">22</span> Streamlit for Financial Analysis</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#caret---a-machine-learning-package-turotial"><span class="header-section-number">21</span> caret - a machine learning package turotial</a></li>
<li><a class="nav-link" href="#introduction-and-description-of-dataset"><span class="header-section-number">21.1</span> Introduction and description of dataset</a></li>
<li><a class="nav-link" href="#pre-processing"><span class="header-section-number">21.2</span> Pre-processing</a></li>
<li>
<a class="nav-link" href="#model-training"><span class="header-section-number">21.3</span> Model training</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#k-nearest-neighbors"><span class="header-section-number">21.3.1</span> K-nearest neighbors</a></li>
<li><a class="nav-link" href="#logistics-regression"><span class="header-section-number">21.3.2</span> Logistics Regression</a></li>
<li><a class="nav-link" href="#support-vector-machine"><span class="header-section-number">21.3.3</span> Support vector machine</a></li>
<li><a class="nav-link" href="#random-forest"><span class="header-section-number">21.3.4</span> Random Forest</a></li>
</ul>
</li>
<li><a class="nav-link" href="#model-prediction-and-evaluation"><span class="header-section-number">21.4</span> Model prediction and evaluation</a></li>
<li><a class="nav-link" href="#reference-2"><span class="header-section-number">21.5</span> Reference</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jtr13/cc21fall1/blob/main/caret_machine_learning_tutorial.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jtr13/cc21fall1/edit/main/caret_machine_learning_tutorial.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>EDAV Fall 2021 Mon/Wed Community Contributions</strong>" was written by the students of the class. It was last built on 2021-11-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
